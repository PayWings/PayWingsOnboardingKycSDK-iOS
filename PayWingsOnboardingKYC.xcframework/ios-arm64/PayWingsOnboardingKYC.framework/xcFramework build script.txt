SCHEME_NAME="PayWingsOnboardingKYC"
FRAMEWORK_NAME="PayWingsOnboardingKYC"

SIMULATOR_ARCHIVE_PATH="./build/${FRAMEWORK_NAME}.framework-iphonesimulator.xcarchive"
DEVICE_ARCHIVE_PATH="./build/${FRAMEWORK_NAME}.framework-iphoneos.xcarchive"

OUTPUT_DIR="./Products/"

# Simulator xcarchive (arm64 + x86_64)
xcodebuild archive \
  ONLY_ACTIVE_ARCH=NO \
  -scheme ${SCHEME_NAME} \
  -configuration Release \
  -workspace PayWingsOnboardingKYC.xcworkspace \
  -archivePath ${SIMULATOR_ARCHIVE_PATH} \
  -destination "generic/platform=iOS Simulator" \
  BUILD_LIBRARY_FOR_DISTRIBUTION=YES \
  SKIP_INSTALL=NO

# Device xcarchive (arm64)
xcodebuild archive \
  -scheme ${SCHEME_NAME} \
  -configuration Release \
  -workspace PayWingsOnboardingKYC.xcworkspace \
  -archivePath ${DEVICE_ARCHIVE_PATH} \
  -destination "generic/platform=iOS" \
  BUILD_LIBRARY_FOR_DISTRIBUTION=YES \
  SKIP_INSTALL=NO

# Clean-up any existing instance of this xcframework from the Products directory
rm -rf "${OUTPUT_DIR}${SCHEME_NAME}.xcframework"

# Create final xcframework
xcodebuild -create-xcframework \
  -framework ${DEVICE_ARCHIVE_PATH}/Products/Library/Frameworks/${FRAMEWORK_NAME}.framework \
  -framework ${SIMULATOR_ARCHIVE_PATH}/Products/Library/Frameworks/${FRAMEWORK_NAME}.framework \
  -output ${OUTPUT_DIR}/${FRAMEWORK_NAME}.xcframework
